# Dify SSE è¯·æ±‚å·¥å…·æ’ä»¶

**orgtinal:** tdcktz
**Author:** è€æ–‡
**Type:** tool

## ğŸ“– æè¿°

è¿™æ˜¯ä¸€ä¸ªä¸ºDifyå·¥ä½œæµè®¾è®¡çš„Server-Sent Events (SSE) è¯·æ±‚å·¥å…·æ’ä»¶ã€‚å®ƒå…è®¸ä½ åœ¨Difyå·¥ä½œæµä¸­å»ºç«‹é•¿è¿æ¥ï¼Œæ¥æ”¶æœåŠ¡å™¨å®æ—¶æ¨é€çš„äº‹ä»¶æµæ•°æ®ï¼Œå¹¶æä¾›æµå¼è¾“å‡ºå’Œæœ€ç»ˆæ±‡æ€»ç»“æœã€‚

### å½“å‰è¯·æ±‚å·¥å…·åˆ†ç±»ï¼š

å½“å‰æ”¯æŒä¸¤ç§sseè¯·æ±‚æ–¹å¼ï¼š

1. é€šç”¨SSE è¯·æ±‚ï¼Œä¼šè¿”å›æ‰€æœ‰äº‹ä»¶
2. Dify Chatflow SSE è¯·æ±‚ï¼Œä»…ä»…ä¼šè¿”å›å…³é”®äº‹ä»¶ä¹Ÿå°±æ˜¯æœ€åèŠ‚ç‚¹å¤§æ¨¡å‹çš„ç›´æ¥å›å¤å†…å®¹ï¼Œé‚£äº›åˆ‡å—äº‹ä»¶ä¸ä¼šéƒ½è¿”å›ã€‚


## èƒŒæ™¯è¯´æ˜ï¼š
åœ¨è¿›è¡Œå·¥ä½œæµæ—¶å€™ï¼Œéœ€è¦è°ƒç”¨ä¸€äº›æ¥å£ï¼Œä½†æ˜¯è¿™äº›æ¥å£è¿”å›çš„æ˜¯ä¸€ä¸ªæµï¼Œéœ€è¦å®æ—¶æ¥æ”¶æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ’ä»¶æ¥æ”¯æŒã€‚


## âœ¨ ä¸»è¦åŠŸèƒ½

- ğŸ”— **é•¿è¿æ¥æ”¯æŒ**: å»ºç«‹å¹¶ç»´æŠ¤SSEé•¿è¿æ¥
- ğŸ“¡ **å®æ—¶æ•°æ®æµ**: æ¥æ”¶æœåŠ¡å™¨æ¨é€çš„å®æ—¶äº‹ä»¶æ•°æ®
- ğŸ” **å¤šç§è®¤è¯æ–¹å¼**: æ”¯æŒBearer Tokenã€API Keyç­‰è®¤è¯æ–¹å¼
- âš™ï¸ **çµæ´»é…ç½®**: è‡ªå®šä¹‰Headersã€æŸ¥è¯¢å‚æ•°ã€è¶…æ—¶è®¾ç½®ç­‰
- ğŸ”„ **è‡ªåŠ¨é‡è¿**: è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æœºåˆ¶
- ğŸ“Š **æµå¼è¾“å‡º**: å®æ—¶è¾“å‡ºæ¥æ”¶åˆ°çš„äº‹ä»¶ï¼ŒåŒæ—¶æä¾›æœ€ç»ˆæ±‡æ€»
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç›‘æ§

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

åœ¨Difyå·¥ä½œæµä¸­æ·»åŠ SSEè¯·æ±‚å·¥å…·ï¼Œé…ç½®ä»¥ä¸‹å‚æ•°ï¼š

```yaml
URL: https://your-sse-server.com/stream
è®¤è¯ç±»å‹: none
è¶…æ—¶æ—¶é—´: 30
æœ€å¤§äº‹ä»¶æ•°: 100
æœ€å¤§æŒç»­æ—¶é—´: 300
```

### å¸¦è®¤è¯çš„è¯·æ±‚

```yaml
URL: https://api.example.com/sse/events
è®¤è¯ç±»å‹: bearer
è®¤è¯ä»¤ç‰Œ: your-bearer-token
è¯·æ±‚å¤´: |
  Content-Type: application/json
  X-Custom-Header: custom-value
æŸ¥è¯¢å‚æ•°: |
  stream: true
  topic: updates
```

## ğŸ“‹ å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `url` | string | âœ… | - | SSEæœåŠ¡å™¨ç«¯ç‚¹URL |
| `headers` | string | âŒ | - | è‡ªå®šä¹‰HTTPå¤´ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼š`key: value` |
| `query_params` | string | âŒ | - | URLæŸ¥è¯¢å‚æ•°ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼š`key: value` |
| `auth_type` | select | âŒ | none | è®¤è¯ç±»å‹ï¼šnone/bearer/api_key |
| `auth_token` | string | âŒ | - | è®¤è¯ä»¤ç‰Œæˆ–APIå¯†é’¥ |
| `auth_header` | string | âŒ | Authorization | APIå¯†é’¥è®¤è¯çš„å¤´åç§° |
| `timeout` | number | âŒ | 30 | è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |
| `max_events` | number | âŒ | 100 | æœ€å¤§æ¥æ”¶äº‹ä»¶æ•° |
| `max_duration` | number | âŒ | 300 | æœ€å¤§è¿æ¥æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ |
| `retry_attempts` | number | âŒ | 3 | è¿æ¥å¤±è´¥é‡è¯•æ¬¡æ•° |

## ğŸ“¤ è¾“å‡ºæ ¼å¼

### å®æ—¶äº‹ä»¶è¾“å‡º

```json
{
  "type": "event",
  "event_number": 1,
  "event_type": "message",
  "data": "å®æ—¶æ¥æ”¶çš„æ•°æ®",
  "event_id": "event-123",
  "timestamp": "2024-01-01T12:00:00Z"
}
```

### æœ€ç»ˆæ±‡æ€»è¾“å‡º

```json
{
  "type": "summary",
  "status": "completed",
  "total_events": 50,
  "connection_duration": 25.5,
  "events": [...],
  "summary": "SSEè¿æ¥æˆåŠŸï¼Œæ¥æ”¶åˆ°50ä¸ªäº‹ä»¶ï¼Œè€—æ—¶25.5ç§’",
  "timestamp": "2024-01-01T12:00:25Z"
}
```

### é”™è¯¯è¾“å‡º

```json
{
  "type": "error",
  "status": "failed",
  "error": "è¿æ¥è¶…æ—¶",
  "timestamp": "2024-01-01T12:00:30Z"
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç‰¹æ€§

- **SSEåè®®æ”¯æŒ**: å®Œæ•´å®ç°SSEåè®®è§„èŒƒ
- **äº‹ä»¶è§£æ**: æ”¯æŒ`data:`ã€`event:`ã€`id:`ã€`retry:`å­—æ®µ
- **æµå¼å¤„ç†**: ä½¿ç”¨httpxçš„streamæ¨¡å¼å¤„ç†é•¿è¿æ¥
- **å¼‚æ­¥æ”¯æŒ**: æ”¯æŒå¼‚æ­¥äº‹ä»¶å¤„ç†å’Œè¶…æ—¶æ§åˆ¶

### ä¾èµ–åº“

- `httpx>=0.25.0`: HTTPå®¢æˆ·ç«¯ï¼Œæ”¯æŒæµå¼è¯·æ±‚
- `dify_plugin>=0.2.0`: Difyæ’ä»¶æ¡†æ¶

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç›‘å¬ChatGPTæµå¼å“åº”

```yaml
URL: https://api.openai.com/v1/chat/completions
è®¤è¯ç±»å‹: bearer
è®¤è¯ä»¤ç‰Œ: sk-your-openai-api-key
è¯·æ±‚å¤´: |
  Content-Type: application/json
æŸ¥è¯¢å‚æ•°: |
  stream: true
  model: gpt-3.5-turbo
```

### ç¤ºä¾‹2ï¼šç›‘å¬å®æ—¶æ—¥å¿—æµ

```yaml
URL: https://your-log-server.com/logs/stream
è®¤è¯ç±»å‹: api_key
è®¤è¯ä»¤ç‰Œ: your-api-key
è®¤è¯å¤´åç§°: X-API-Key
æŸ¥è¯¢å‚æ•°: |
  level: info
  service: web-app
æœ€å¤§äº‹ä»¶æ•°: 1000
æœ€å¤§æŒç»­æ—¶é—´: 600
```


## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªæ’ä»¶ï¼

## ğŸ“„ è®¸å¯è¯

MIT License



