identity:
  name: "dify_chatflow_sse"
  author: "è€æ–‡"
  label:
    en_US: "Dify Chatflow SSE"
    zh_Hans: "Dify Chatflow SSE è¯·æ±‚"
    pt_BR: "Dify Chatflow SSE"
  description:
    en_US: "Specialized SSE tool for Dify Chatflow that extracts answer content from workflow_finished and message_end events."
    zh_Hans: "ä¸“é—¨ç”¨äºDify Chatflowçš„SSEå·¥å…·ï¼Œä»workflow_finishedå’Œmessage_endäº‹ä»¶ä¸­æå–ç­”æ¡ˆå†…å®¹ã€‚"
    pt_BR: "Ferramenta SSE especializada para Dify Chatflow que extrai conteÃºdo de resposta de eventos workflow_finished e message_end."
  icon: "ğŸ”„"
description:
  human:
    en_US: "Specialized SSE tool for Dify Chatflow that extracts answer content from workflow_finished and message_end events."
    zh_Hans: "ä¸“é—¨ç”¨äºDify Chatflowçš„SSEå·¥å…·ï¼Œä»workflow_finishedå’Œmessage_endäº‹ä»¶ä¸­æå–ç­”æ¡ˆå†…å®¹ã€‚"
    pt_BR: "Ferramenta SSE especializada para Dify Chatflow que extrai conteÃºdo de resposta de eventos workflow_finished e message_end."
  llm: "A specialized Server-Sent Events tool for Dify Chatflow that monitors SSE streams and extracts answer content from specific workflow events."
parameters:
  - name: url
    type: string
    required: true
    default: "http://api:5001/v1/chat-messages"
    label:
      en_US: "Dify Chatflow SSE URL"
      zh_Hans: "Dify Chatflow SSE URL"
      pt_BR: "URL do Dify Chatflow SSE"
    human_description:
      en_US: "Enter the complete Dify Chatflow SSE URL. Must start with http:// or https://. Example: http://api:5001/v1/chat-messages. Make sure the endpoint supports Server-Sent Events for Dify Chatflow."
      zh_Hans: "è¾“å…¥å®Œæ•´çš„Dify Chatflow SSE URLã€‚å¿…é¡»ä»¥http://æˆ–https://å¼€å¤´ã€‚ç¤ºä¾‹ï¼šhttp://api:5001/v1/chat-messagesã€‚ç¡®ä¿ç«¯ç‚¹æ”¯æŒDify Chatflowçš„æœåŠ¡å™¨å‘é€äº‹ä»¶ã€‚"
      pt_BR: "Digite a URL completa do Dify Chatflow SSE. Deve comeÃ§ar com http:// ou https://. Exemplo: http://api:5001/v1/chat-messages. Certifique-se de que o endpoint suporte Server-Sent Events para Dify Chatflow."
    llm_description: "The complete URL of the Dify Chatflow SSE endpoint, must start with http:// or https://"
    form: llm

  - name: method
    type: select
    required: false
    default: "POST"
    label:
      en_US: "HTTP Method"
      zh_Hans: "HTTP æ–¹æ³•"
      pt_BR: "MÃ©todo HTTP"
    human_description:
      en_US: "Choose the HTTP method for your Dify Chatflow request. POST: most common for Dify Chatflow API. GET: for simple requests without body data. PUT/PATCH: for updating resources. DELETE: for deletion operations."
      zh_Hans: "é€‰æ‹©Dify Chatflowè¯·æ±‚çš„HTTPæ–¹æ³•ã€‚POSTï¼šDify Chatflow APIæœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚GETï¼šç”¨äºä¸éœ€è¦å‘é€æ•°æ®çš„ç®€å•è¯·æ±‚ã€‚PUT/PATCHï¼šç”¨äºæ›´æ–°èµ„æºã€‚DELETEï¼šç”¨äºåˆ é™¤æ“ä½œã€‚"
      pt_BR: "Escolha o mÃ©todo HTTP para sua solicitaÃ§Ã£o Dify Chatflow. POST: mais comum para API Dify Chatflow. GET: para solicitaÃ§Ãµes simples sem dados do corpo. PUT/PATCH: para atualizar recursos. DELETE: para operaÃ§Ãµes de exclusÃ£o."
    llm_description: "HTTP method for the Dify Chatflow SSE request"
    form: form
    options:
      - value: "POST"
        label:
          en_US: "POST"
          zh_Hans: "POST"
          pt_BR: "POST"
      - value: "GET"
        label:
          en_US: "GET"
          zh_Hans: "GET"
          pt_BR: "GET"
      - value: "PUT"
        label:
          en_US: "PUT"
          zh_Hans: "PUT"
          pt_BR: "PUT"
      - value: "PATCH"
        label:
          en_US: "PATCH"
          zh_Hans: "PATCH"
          pt_BR: "PATCH"
      - value: "DELETE"
        label:
          en_US: "DELETE"
          zh_Hans: "DELETE"
          pt_BR: "DELETE"

  - name: headers
    type: string
    required: false
    default: '{"Content-Type": "application/json", "Accept": "text/event-stream", "Authorization": "Bearer YOUR_API_KEY"}'
    label:
      en_US: "Request Headers"
      zh_Hans: "è¯·æ±‚å¤´"
      pt_BR: "CabeÃ§alhos da RequisiÃ§Ã£o"
    human_description:
      en_US: "Enter HTTP headers as a JSON object. For Dify Chatflow, typically include Authorization header. Example: {\"Authorization\": \"Bearer your-api-key\", \"Content-Type\": \"application/json\"}. The Accept and Content-Type headers for SSE are automatically set."
      zh_Hans: "ä»¥JSONå¯¹è±¡æ ¼å¼è¾“å…¥HTTPè¯·æ±‚å¤´ã€‚å¯¹äºDify Chatflowï¼Œé€šå¸¸éœ€è¦åŒ…å«Authorizationå¤´ã€‚ç¤ºä¾‹ï¼š{\"Authorization\": \"Bearer your-api-key\", \"Content-Type\": \"application/json\"}ã€‚SSEçš„Acceptå’ŒContent-Typeå¤´ä¼šè‡ªåŠ¨è®¾ç½®ã€‚"
      pt_BR: "Digite os cabeÃ§alhos HTTP como um objeto JSON. Para Dify Chatflow, normalmente inclua o cabeÃ§alho Authorization. Exemplo: {\"Authorization\": \"Bearer your-api-key\", \"Content-Type\": \"application/json\"}. Os cabeÃ§alhos Accept e Content-Type para SSE sÃ£o definidos automaticamente."
    llm_description: "HTTP headers in JSON format, typically including Authorization for Dify API access"
    form: llm

  - name: query_params
    type: string
    required: false
    default: '{}'
    label:
      en_US: "Query Parameters"
      zh_Hans: "æŸ¥è¯¢å‚æ•°"
      pt_BR: "ParÃ¢metros de Consulta"
    human_description:
      en_US: "Enter URL query parameters as a JSON object. Example: {\"user\": \"user-123\", \"stream\": \"true\"}. These will be appended to the URL as query string parameters."
      zh_Hans: "ä»¥JSONå¯¹è±¡æ ¼å¼è¾“å…¥URLæŸ¥è¯¢å‚æ•°ã€‚ç¤ºä¾‹ï¼š{\"user\": \"user-123\", \"stream\": \"true\"}ã€‚è¿™äº›å‚æ•°ä¼šè¢«æ·»åŠ åˆ°URLåé¢ä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ã€‚"
      pt_BR: "Digite os parÃ¢metros de consulta da URL como um objeto JSON. Exemplo: {\"user\": \"user-123\", \"stream\": \"true\"}. Estes serÃ£o anexados Ã  URL como parÃ¢metros de string de consulta."
    llm_description: "URL query parameters in JSON format for Dify Chatflow API"
    form: llm

  - name: body_type
    type: select
    required: false
    default: "json"
    label:
      en_US: "Request Body Type"
      zh_Hans: "è¯·æ±‚ä½“ç±»å‹"
      pt_BR: "Tipo do Corpo da RequisiÃ§Ã£o"
    human_description:
      en_US: "Select the format of your request body. JSON: for Dify Chatflow API (recommended). Text: for plain text content. Form: for form-encoded data. XML: for XML documents."
      zh_Hans: "é€‰æ‹©è¯·æ±‚ä½“çš„æ ¼å¼ã€‚JSONï¼šç”¨äºDify Chatflow APIï¼ˆæ¨èï¼‰ã€‚Textï¼šç”¨äºçº¯æ–‡æœ¬å†…å®¹ã€‚Formï¼šç”¨äºè¡¨å•ç¼–ç æ•°æ®ã€‚XMLï¼šç”¨äºXMLæ–‡æ¡£ã€‚"
      pt_BR: "Selecione o formato do corpo da sua solicitaÃ§Ã£o. JSON: para API Dify Chatflow (recomendado). Text: para conteÃºdo de texto simples. Form: para dados codificados em formulÃ¡rio. XML: para documentos XML."
    llm_description: "Type of request body content for Dify Chatflow API"
    form: form
    options:
      - value: "json"
        label:
          en_US: "JSON"
          zh_Hans: "JSON"
          pt_BR: "JSON"
      - value: "text"
        label:
          en_US: "text"
          zh_Hans: "text"
          pt_BR: "text"
      - value: "form"
        label:
          en_US: "form"
          zh_Hans: "form"
          pt_BR: "form"
      - value: "xml"
        label:
          en_US: "xml"
          zh_Hans: "xml"
          pt_BR: "xml"

  - name: body
    type: string
    required: false
    default: '{"inputs": {}, "query": "ä½ å¥½", "response_mode": "streaming", "conversation_id": "", "user": "user-123"}'
    label:
      en_US: "Request Body"
      zh_Hans: "è¯·æ±‚ä½“"
      pt_BR: "Corpo da RequisiÃ§Ã£o"
    human_description:
      en_US: "Enter the request body for Dify Chatflow API. JSON example: {\"inputs\": {}, \"query\": \"Hello\", \"response_mode\": \"streaming\", \"conversation_id\": \"\", \"user\": \"user-123\"}. Make sure to set response_mode to \"streaming\" for SSE support."
      zh_Hans: "è¾“å…¥Dify Chatflow APIçš„è¯·æ±‚ä½“ã€‚JSONç¤ºä¾‹ï¼š{\"inputs\": {}, \"query\": \"ä½ å¥½\", \"response_mode\": \"streaming\", \"conversation_id\": \"\", \"user\": \"user-123\"}ã€‚ç¡®ä¿å°†response_modeè®¾ç½®ä¸º\"streaming\"ä»¥æ”¯æŒSSEã€‚"
      pt_BR: "Digite o corpo da solicitaÃ§Ã£o para a API Dify Chatflow. Exemplo JSON: {\"inputs\": {}, \"query\": \"OlÃ¡\", \"response_mode\": \"streaming\", \"conversation_id\": \"\", \"user\": \"user-123\"}. Certifique-se de definir response_mode como \"streaming\" para suporte SSE."
    llm_description: "Request body content for Dify Chatflow API, typically JSON with query and streaming mode"
    form: llm

  - name: timeout
    type: number
    required: false
    default: 300
    label:
      en_US: "Connection Timeout (seconds)"
      zh_Hans: "è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰"
      pt_BR: "Timeout de ConexÃ£o (segundos)"
    human_description:
      en_US: "Set the connection timeout in seconds. Recommended: 60s for Dify Chatflow (default), 120s+ for complex workflows. If the server doesn't respond within this time, the connection will fail."
      zh_Hans: "è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ã€‚å»ºè®®ï¼šDify Chatflowç”¨60ç§’ï¼ˆé»˜è®¤ï¼‰ï¼Œå¤æ‚å·¥ä½œæµç”¨120ç§’ä»¥ä¸Šã€‚å¦‚æœæœåŠ¡å™¨åœ¨æ­¤æ—¶é—´å†…æœªå“åº”ï¼Œè¿æ¥å°†å¤±è´¥ã€‚"
      pt_BR: "Defina o tempo limite de conexÃ£o em segundos. Recomendado: 60s para Dify Chatflow (padrÃ£o), 120s+ para fluxos de trabalho complexos. Se o servidor nÃ£o responder dentro deste tempo, a conexÃ£o falharÃ¡."
    llm_description: "Connection timeout in seconds for Dify Chatflow API"
    form: form

  - name: max_events
    type: number
    required: false
    default: 10000
    label:
      en_US: "Maximum Events"
      zh_Hans: "æœ€å¤§äº‹ä»¶æ•°"
      pt_BR: "MÃ¡ximo de Eventos"
    human_description:
      en_US: "Limit the number of events to collect. Recommended: 200 for Dify Chatflow (default), 500+ for long conversations. The connection will close after reaching this limit to prevent memory overflow."
      zh_Hans: "é™åˆ¶æ”¶é›†çš„äº‹ä»¶æ•°é‡ã€‚å»ºè®®ï¼šDify Chatflowç”¨200ä¸ªï¼ˆé»˜è®¤ï¼‰ï¼Œé•¿å¯¹è¯ç”¨500+ä¸ªã€‚è¾¾åˆ°æ­¤é™åˆ¶åè¿æ¥ä¼šå…³é—­ï¼Œä»¥é˜²æ­¢å†…å­˜æº¢å‡ºã€‚"
      pt_BR: "Limite o nÃºmero de eventos a coletar. Recomendado: 200 para Dify Chatflow (padrÃ£o), 500+ para conversas longas. A conexÃ£o serÃ¡ fechada apÃ³s atingir este limite para evitar estouro de memÃ³ria."
    llm_description: "Maximum number of events to collect from Dify Chatflow"
    form: form

  - name: max_duration
    type: number
    required: false
    default: 600
    label:
      en_US: "Maximum Duration (seconds)"
      zh_Hans: "æœ€å¤§æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰"
      pt_BR: "DuraÃ§Ã£o MÃ¡xima (segundos)"
    human_description:
      en_US: "Maximum duration to keep listening for events (in seconds). Recommended: 600s (10min) for Dify Chatflow (default), 1800s (30min) for complex workflows. The connection will automatically close after this time."
      zh_Hans: "ä¿æŒç›‘å¬äº‹ä»¶çš„æœ€å¤§æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ã€‚å»ºè®®ï¼šDify Chatflowç”¨600ç§’ï¼ˆ10åˆ†é’Ÿï¼Œé»˜è®¤ï¼‰ï¼Œå¤æ‚å·¥ä½œæµç”¨1800ç§’ï¼ˆ30åˆ†é’Ÿï¼‰ã€‚è¶…è¿‡æ­¤æ—¶é—´è¿æ¥ä¼šè‡ªåŠ¨å…³é—­ã€‚"
      pt_BR: "DuraÃ§Ã£o mÃ¡xima para manter a escuta de eventos (em segundos). Recomendado: 600s (10min) para Dify Chatflow (padrÃ£o), 1800s (30min) para fluxos de trabalho complexos. A conexÃ£o serÃ¡ fechada automaticamente apÃ³s este tempo."
    llm_description: "Maximum duration to keep the Dify Chatflow connection alive in seconds"
    form: form

# è¾“å‡ºå˜é‡å®šä¹‰ - å·¥ä½œæµä¸­å¯å¼•ç”¨çš„æ‰€æœ‰è¾“å‡ºå˜é‡
output_schema:
  type: object
  properties:
    chatflow_answer:
      type: string
      description: "Extracted answer content from Dify Chatflow workflow_finished event"
    events_stream:
      type: array
      description: "Stream of key SSE events (workflow_finished and message_end) for workflow processing"
      items:
        type: object
        properties:
          event_number:
            type: number
            description: "Sequential event number"
          event_type:
            type: string
            description: "SSE event type"
          data:
            description: "SSE event data (can be string or parsed object)"
          event_id:
            type: string
            description: "SSE event ID"
          timestamp:
            type: string
            description: "Event timestamp"
          retry:
            type: number
            description: "SSE retry value"
    connection_status:
      type: string
      description: "Simple connection status (completed, failed, error)"
    total_events:
      type: number
      description: "Total number of key events received (workflow_finished and message_end)"
    connection_duration:
      type: number
      description: "Connection duration in seconds"
    error:
      type: string
      description: "Error message if connection failed"

extra:
  python:
    source: tools/dify_chatflow_sse.py